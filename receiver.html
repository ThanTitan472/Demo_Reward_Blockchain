<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Hiển Thị Thông Tin</title>
<script>
window.onload = function() {
  const ws = new WebSocket('ws://localhost:3001');
  ws.onopen = function() {
    console.log('Connected to the server');
  };
  ws.onmessage = function(event) {
    
    var message = JSON.parse(event.data);
    if(message.type === 'sendtask')
    {
      document.getElementById('display').innerHTML =
        'ID: ' + message.content.id + '<br>'
        +
        'Creator: ' + message.content.creator + '<br>' +
        'Description: ' + message.content.description + '<br>' +
        'Difficult: ' + message.content.diff + '<br>' +
        'Reward: ' + message.content.reward;
    //     message.content.forEach(function(task) {
    //   var taskDiv = document.createElement('div');
    //   taskDiv.innerHTML = 
    //     'ID Task: ' + task.id + '<br>' +
    //     'Creator: ' + task.creator + '<br>' +
    //     'Description: ' + task.description + '<br>' +
    //     'Difficult: ' + task.diff + '<br>' +
    //     'Reward: ' + task.reward;
    //   displayDiv.appendChild(taskDiv);
    // });
    }
    if(message.type === 'returnWallet')
    {
      document.getElementById('balance').innerHTML = 'Balance: ' + message.balance;
    }
  };

  document.getElementById('responseForm').onsubmit = function(event) {
    event.preventDefault();
    var id = document.getElementById('id').value;
    var assignee = document.getElementById('assignee').value;
    var solution = document.getElementById('solution').value;

    // var data = {
    //   type: 'response',
    //   content: {
    //     idTask: id,
    //     assignee: assignee,
    //     solution: solution
    //   }
    // };
    var data = {
      type: 'acceptTask',
      content : 
      {
        id: id,
        assignee: assignee,
        solution: solution
      }
    };

    ws.send(JSON.stringify(data));
    this.reset();
  };
  document.getElementById('walletForm').onsubmit = function(event) {
    event.preventDefault();
    var address = document.getElementById('address').value;

    var data = {
      type: 'checkWallet',
      address : address
    };

    ws.send(JSON.stringify(data));
  };
};
</script>
</head>
<body>

<h2>Thông Tin Được Nhận qua WebSocket</h2>
<div id="display"></div>

<h2>Form Phản Hồi Thông Tin</h2>

<form id="responseForm">
  <label for="id">ID Task:</label><br>
  <input type="text" id="id" name="id"><br>
  <label for="assignee">Assignee:</label><br>
  <input type="text" id="assignee" name="assignee"><br>
  <label for="solution">Solution:</label><br>
  <input type="text" id="solution" name="solution"><br><br>
  <input type="submit" value="Submit">
</form>

<form id="walletForm"">
  <label for="address">Adress:</label><br>
  <input type="text" id="address" name="address"><br>
  <input type="submit" value="Submit">
</form>

<div id="balance"></div>

</body>
</html>
